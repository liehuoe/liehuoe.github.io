(function(e){function t(t){for(var n,s,l=t[0],o=t[1],c=t[2],h=0,g=[];h<l.length;h++)s=l[h],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&g.push(i[s][0]),i[s]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);u&&u(t);while(g.length)g.shift()();return r.push.apply(r,c||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],n=!0,l=1;l<a.length;l++){var o=a[l];0!==i[o]&&(n=!1)}n&&(r.splice(t--,1),e=s(s.s=a[0]))}return e}var n={},i={app:0},r=[];function s(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=n,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(a,n,function(t){return e[t]}.bind(null,n));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],o=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=o;r.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("cd49")},"034f":function(e,t,a){"use strict";a("85ec")},1926:function(e,t,a){"use strict";a("45b6")},"232e":function(e,t,a){"use strict";a("6564")},"45b6":function(e,t,a){},6564:function(e,t,a){},"6f48":function(e,t,a){"use strict";a("7238")},7238:function(e,t,a){},"85ec":function(e,t,a){},cd49:function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("Header"),a("Main"),a("Footer")],1)},r=[],s=a("d4ec"),l=a("262e"),o=a("2caf"),c=a("9ab4"),u=a("1b40"),h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"main"},[a("el-page-header",{staticClass:"header",attrs:{title:"返回首页"},on:{back:e.onBack}}),a("div",{staticClass:"logo",on:{click:e.onBack}},[a("img",{staticClass:"logo-img",attrs:{src:"http://www.gmkiss.com/wp-content/uploads/2021/11/gmkiss-logo-1.png"}}),a("span",{staticClass:"logo-text",attrs:{alt:"keywords"}},[e._v("NFT数字绘画板")])])],1)},g=[],y=a("bee2"),f=function(e){Object(l["a"])(a,e);var t=Object(o["a"])(a);function a(){return Object(s["a"])(this,a),t.apply(this,arguments)}return Object(y["a"])(a,[{key:"onBack",value:function(){location.href=location.origin}}]),a}(u["c"]);f=Object(c["a"])([u["a"]],f);var m=f,p=m,d=(a("232e"),a("2877")),v=Object(d["a"])(p,h,g,!1,null,"64fa9bad",null),x=v.exports,b=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"main"},[a("div",{staticStyle:{"margin-bottom":"10px"}},[a("div",{staticClass:"body"},[a("canvas",{ref:"grid",staticClass:"grid",attrs:{width:"500",height:"500"}}),a("canvas",{ref:"canvas",staticClass:"canvas",attrs:{width:"480",height:"480"}})]),a("div",{staticClass:"btns"},[a("el-checkbox",{model:{value:e.grid,callback:function(t){e.grid=t},expression:"grid"}},[e._v("显示网格")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.onExport}},[e._v(" 合成图片 ")]),a("el-button",{attrs:{size:"small"},on:{click:e.onSave}},[e._v("本地暂存")]),a("el-button",{attrs:{size:"small"},on:{click:function(t){return e.file.click()}}},[a("input",{ref:"file",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:e.onLoad}}),e._v(" 本地读取 ")]),a("el-button",{attrs:{size:"small"},on:{click:function(t){return e.onUrl("http://www.gmkiss.com/nftdraw/")}}},[e._v(" 绘画教程 ")])],1)]),a("div",{staticClass:"tool"},[a("div",{staticClass:"tool-left"},[a("el-container",{staticClass:"history"},[a("el-header",[e._v("动作记录")]),a("el-main",[a("ul",{staticClass:"history-list"},e._l(e.history,(function(t,n){return a("li",{key:n,style:n<e.hisIndex?"color: #aaa":""},[e._v(" "+e._s(t.type)+" ")])})),0)]),a("el-footer",[a("el-button",{attrs:{type:"text"},on:{click:e.onBack}},[e._v("撤回上一步")])],1)],1),a("el-radio-group",{model:{value:e.tool,callback:function(t){e.tool=t},expression:"tool"}},[a("el-radio",{attrs:{label:1}},[e._v("画笔")]),a("el-radio",{attrs:{label:0}},[e._v("橡皮")]),a("el-radio",{attrs:{label:2}},[e._v("吸管")])],1),a("Sketch",{staticStyle:{"margin-top":"10px"},model:{value:e.colors,callback:function(t){e.colors=t},expression:"colors"}})],1),a("el-collapse",{staticClass:"layer",attrs:{accordion:""},model:{value:e.layerSel,callback:function(t){e.layerSel=t},expression:"layerSel"}},e._l(e.layers,(function(t,n){return a("el-collapse-item",{key:n,attrs:{name:n}},[a("div",{staticClass:"layer-title",attrs:{slot:"title",title:t.name},slot:"title"},[a("i",{class:t.show?"icon-eye-show":"icon-eye-hide",on:{click:function(t){return t.stopPropagation(),e.onLayerShow(n)}}}),e._v(" "+e._s(t.name)+" ")]),e._l(t.images,(function(t,i){return a("div",{key:i,staticClass:"layer-item"},[a("el-radio",{staticClass:"img-title",attrs:{value:e.imgSel[n],label:i,title:t.name},nativeOn:{click:function(t){return t.preventDefault(),e.onImageChange(n,i)}}},[e._v(" "+e._s(t.name)+" ")]),a("i",{staticClass:"el-icon-copy-document",staticStyle:{cursor:"pointer"},attrs:{title:"复制图层"},on:{click:function(t){return e.onImageCopy(n,i)}}}),0!==n?a("i",{staticClass:"el-icon-top",staticStyle:{cursor:"pointer"},attrs:{title:"上移一层"},on:{click:function(t){return e.onLayerUp(n,i)}}}):e._e(),n!==e.layers.length-1?a("i",{staticClass:"el-icon-bottom",staticStyle:{cursor:"pointer"},attrs:{title:"下移一层"},on:{click:function(t){return e.onLayerDown(n,i)}}}):e._e(),a("i",{staticClass:"el-icon-edit",staticStyle:{cursor:"pointer"},attrs:{title:"修改名称"},on:{click:function(t){return e.onImageName(n,i)}}}),a("i",{staticClass:"el-icon-delete",staticStyle:{cursor:"pointer"},attrs:{title:"删除"},on:{click:function(t){return e.onImageDel(n,i)}}})],1)})),a("div",{staticClass:"layer-btn"},[a("i",{staticClass:"el-icon-circle-plus-outline",on:{click:function(t){return e.addImage(n)}}},[e._v(" 添加新图 ")]),a("i",{staticClass:"el-icon-edit",on:{click:function(t){return e.changeLayerName(n)}}},[e._v(" 修改层名 ")])])],2)})),1)],1),e.exportDlg.show?a("el-dialog",{attrs:{"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,title:e.exportDlg.title,visible:e.exportDlg.show},on:{"update:visible":function(t){return e.$set(e.exportDlg,"show",t)}}},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":26,percentage:e.exportDlg.percent}}),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.exportDlg.onCancel}},[e._v(" 取 消 ")]),a("el-button",{attrs:{type:"primary",loading:e.exportDlg.loading,disabled:e.exportDlg.loading},on:{click:e.exportDlg.onSubmit}},[e._v(" 打包下载 ")])],1)],1):e._e(),a("el-dialog",{attrs:{title:"请选择复制图片的种类",visible:e.copyDlg.show,width:"30%"},on:{"update:visible":function(t){return e.$set(e.copyDlg,"show",t)}}},[a("el-checkbox-group",{model:{value:e.copyDlg.value,callback:function(t){e.$set(e.copyDlg,"value",t)},expression:"copyDlg.value"}},e._l(e.copyDlg.types,(function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(" "+e._s(t)+" ")])})),1),a("div",{staticStyle:{"margin-top":"14px"}},[e._v(" 注意：复制出的图片为同名图片，参与排列组合的方式为轮替排列。如果想按普通方式组合，可以手动修改为不同名称。 ")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.copyDlg.show=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.copyImage}},[e._v("确 定")])],1)],1)],1)},S=[],w=a("b85c"),k=a("2909"),I=a("1da1"),O=(a("96cf"),a("99af"),a("fb6a"),a("b0c0"),a("a434"),a("d3b7"),a("159b"),a("ac1f"),a("a9e3"),a("4d90"),a("25f0"),a("7db0"),a("cb29"),a("e9c4"),a("1276"),a("c345")),j=a("c4e3"),_=a.n(j),C=a("21a6"),D=function(e){Object(l["a"])(a,e);var t=Object(o["a"])(a);function a(){var e;return Object(s["a"])(this,a),e=t.apply(this,arguments),e.grid=!0,e.tool=1,e.colors={rgba:{r:25,g:77,b:51,a:1}},e.layers=[],e.layerSel=null,e.imgSel=[],e.colorSrc=new Array(576),e.copyDlg={layerIndex:0,imgIndex:0,show:!1,types:["原图","变色1","变色2","变色3"],value:["原图"]},e.imageColor={"原图":function(e){return e},"变色1":function(e){return"#".concat(e.slice(1,3)).concat(e.slice(5,7)).concat(e.slice(3,5)).concat(e.slice(7,9))},"变色2":function(e){return"#".concat(e.slice(3,5)).concat(e.slice(1,3)).concat(e.slice(5,7)).concat(e.slice(7,9))},"变色3":function(e){return"#".concat(e.slice(5,7)).concat(e.slice(1,3)).concat(e.slice(3,5)).concat(e.slice(7,9))}},e.exportDlg={show:!1},e.history=[],e.hisIndex=0,e.historyOp={"修改图层名称":function(t){var a=e.layers[t.layerIndex].name;e.layers[t.layerIndex].name=t.name,t.name=a},"添加图片":function(t){if(t.image)e.layers[t.layerIndex].images.splice(t.imgIndex,0,t.image),t.image=void 0;else{e.imgSel[t.layerIndex]===t.imgIndex&&(e.imgSel[t.layerIndex]=null);var a=e.layers[t.layerIndex].images.splice(t.imgIndex,1)[0];t.image=a}},"修改图片名称":function(t){var a=e.layers[t.layerIndex].images[t.imgIndex].name;e.layers[t.layerIndex].images[t.imgIndex].name=t.name,t.name=a},"复制图片":function(t){if(t.image){var a=t.image;t.imgIndex.forEach((function(n,i){e.layers[t.layerIndex].images.splice(n,0,a[i])})),t.image=void 0}else t.image=[],t.imgIndex.forEach((function(a){var n;e.imgSel[t.layerIndex]===a&&(e.imgSel[t.layerIndex]=null);var i=e.layers[t.layerIndex].images.splice(a,1)[0];null===(n=t.image)||void 0===n||n.push(i)}))},"移动图片":function(t){e.imgSel[t.dstLayer]===t.dstImg&&(e.imgSel[t.dstLayer]=null);var a=e.layers[t.dstLayer].images.splice(t.dstImg,1)[0];e.layers[t.srcLayer].images.splice(t.srcImg,0,a);var n=[t.dstLayer,t.srcLayer];t.srcLayer=n[0],t.dstLayer=n[1];var i=[t.dstImg,t.srcImg];t.srcImg=i[0],t.dstImg=i[1]},"删除图片":function(t){if(t.image)e.layers[t.layerIndex].images.splice(t.imgIndex,0,t.image),t.image=void 0;else{e.imgSel[t.layerIndex]===t.imgIndex&&(e.imgSel[t.layerIndex]=null);var a=e.layers[t.layerIndex].images.splice(t.imgIndex,1)[0];t.image=a}},"画笔":function(t){var a=e.layers[t.layerIndex].images[t.imgIndex].data;e.layers[t.layerIndex].images[t.imgIndex].data=t.data,t.data=a},"橡皮":function(t){var a=e.layers[t.layerIndex].images[t.imgIndex].data;e.layers[t.layerIndex].images[t.imgIndex].data=t.data,t.data=a}},e}return Object(y["a"])(a,[{key:"mounted",value:function(){var e=Object(I["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.initLayer(),this.initCanvas(),this.onGrid();case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"onGrid",value:function(){var e=this.$refs.grid,t=null===e||void 0===e?void 0:e.getContext("2d");if(t){t.clearRect(0,0,500,500),t.lineWidth=1,t.strokeStyle="#ccc",t.beginPath();for(var a=0;a<25;++a)t.moveTo(20*a+9.5,0),t.lineTo(20*a+9.5,500);for(var n=0;n<25;++n)t.moveTo(0,20*n+9.5),t.lineTo(500,20*n+9.5);t.stroke(),this.grid||(t.fillStyle="white",t.fillRect(10,10,479,479))}}},{key:"initCanvas",value:function(){this.canvas.addEventListener("mousedown",this.onMouseDown),this.canvas.addEventListener("touchstart",this.onMouseDown)}},{key:"ctx",get:function(){return this.canvas.getContext("2d")}},{key:"setDrawing",value:function(e){if(e){if(this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("touchmove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("touchend",this.onMouseUp),this.ctx){var t=this.colors.rgba;this.ctx.fillStyle="rgba(".concat(t.r,",").concat(t.g,",").concat(t.b,",").concat(t.a,")")}}else this.canvas.removeEventListener("mousemove",this.onMouseMove),this.canvas.removeEventListener("touchmove",this.onMouseMove),this.canvas.removeEventListener("mouseup",this.onMouseUp),this.canvas.removeEventListener("touchend",this.onMouseUp)}},{key:"draw",value:function(e,t){if(this.ctx&&"number"===typeof this.layerSel){var a=20*e,n=20*t,i=24*t+e,r=this.colorSrc[i];if(0===this.tool){if("number"!==typeof r||r>this.layerSel)return;var s=this.imgSel[this.layerSel];if("number"!==typeof s)return;var l=this.layers[this.layerSel].images[s].data;if(l[i]=null,r!==this.layerSel)return;var o=this.delColor(i);if(o){var c=this.ctx.fillStyle;this.ctx.fillStyle=o,this.ctx.fillRect(a,n,20,20),this.ctx.fillStyle=c}else this.ctx.clearRect(a,n,20,20)}else{if("string"===typeof this.ctx.fillStyle){var u=/\(.*,.*,.*,(.*)\)/.exec(this.ctx.fillStyle);if(u&&Number(u[1])<=0)return;if(u=/#.{2}.{2}.{2}(.{2})/.exec(this.ctx.fillStyle),u&&"00"===u[1])return}if("number"!==typeof r||this.layerSel<=r){this.layerSel!==r&&(this.colorSrc[i]=this.layerSel,this.ctx.clearRect(a,n,20,20)),this.ctx.fillRect(a,n,20,20);var h=this.imgSel[this.layerSel];if("number"===typeof h){var g=this.ctx.getImageData(a,n,1,1).data,y="#";g.forEach((function(e){return y+=e.toString(16).padStart(2,"0")})),this.layers[this.layerSel].images[h].data[i]=y}}else{var f=this.ctx.getImageData(a,n,1,1);this.ctx.clearRect(a,n,1,1);var m=this.imgSel[this.layerSel];if("number"===typeof m){var p=this.layers[this.layerSel].images[m].data[i];if(p){var d=this.ctx.fillStyle;this.ctx.fillStyle=p,this.ctx.fillRect(a,n,1,1),this.ctx.fillStyle=d}this.ctx.fillRect(a,n,1,1);var v=this.ctx.getImageData(a,n,1,1).data;p="#",v.forEach((function(e){return p+=e.toString(16).padStart(2,"0")})),this.layers[this.layerSel].images[m].data[i]=p}this.ctx.putImageData(f,a,n)}}}}},{key:"onMouseDown",value:function(e){if("number"===typeof this.layerSel&&"number"===typeof this.imgSel[this.layerSel]){var t=this.layerSel,a=this.imgSel[this.layerSel]||0;1===this.tool?this.pushHistory({type:"画笔",layerIndex:t,imgIndex:a,data:Object(k["a"])(this.layers[t].images[a].data)}):0===this.tool&&this.pushHistory({type:"橡皮",layerIndex:t,imgIndex:a,data:Object(k["a"])(this.layers[t].images[a].data)}),this.setDrawing(!0),this.onMouseMove(e)}else this.$message({message:"需要创建并选择一张图才能进行绘画——1.点击右侧图层。2.添加新图。3.选择图片进行绘画。",type:"warning"})}},{key:"onMouseMove",value:function(e){var t;t=e.changedTouches?e.changedTouches[0]:e;var a=this.canvas.getBoundingClientRect(),n=Math.round(t.clientX-a.left),i=Math.round(t.clientY-a.top);if(!(n<=0||i<=0||n>=480||i>=480))if(2===this.tool){var r,s,l=null===(r=this.ctx)||void 0===r||null===(s=r.getImageData(n,i,1,1))||void 0===s?void 0:s.data;l&&(this.colors={rgba:{r:l[0],g:l[1],b:l[2],a:l[3]/255}})}else n=Math.floor(n/20),i=Math.floor(i/20),this.draw(n,i)}},{key:"onMouseUp",value:function(){this.setDrawing(!1)}},{key:"onUrl",value:function(e){window.open(e,"_blank")}},{key:"initLayer",value:function(){for(var e=0;e<9;++e)this.layers.push({show:!0,name:"图层 ".concat(e+1),images:[]}),this.imgSel.push(null);this.layers.push({show:!0,name:"背景",images:[]}),this.imgSel.push(null)}},{key:"onLayerShow",value:function(e){var t=this.layers[e];t.show=!t.show,this.redraw(e)}},{key:"onImageChange",value:function(e,t){this.$set(this.imgSel,e,this.imgSel[e]===t?null:t),this.redraw(e)}},{key:"calcAllColor",value:function(){for(var e=0;e<this.colorSrc.length;++e){for(var t=0;t<this.layers.length;++t){var a=this.layers[t];if(a.show){var n=this.imgSel[t];if("number"===typeof n){var i=a.images[n].data[e];if(i)break}}}t===this.layers.length?this.colorSrc[e]=null:this.colorSrc[e]=t}}},{key:"calcLayerColor",value:function(e){var t=this.layers[e],a=this.imgSel[e];if(t.show&&"number"===typeof a){if("number"===typeof a)for(var n=0;n<this.colorSrc.length;++n){var i=this.colorSrc[n];if(!("number"===typeof i&&i<e)){var r=t.images[a].data[n];r?this.colorSrc[n]=e:i===e&&this.delColor(n)}}}else for(var s=0;s<this.colorSrc.length;++s)this.colorSrc[s]===e&&this.delColor(s)}},{key:"delColor",value:function(e){var t=this.colorSrc[e];if("number"!==typeof t)return null;for(var a=t+1;a<this.layers.length;++a){var n=this.layers[a];if(n.show){var i=this.imgSel[a];if("number"===typeof i){var r=n.images[i].data;if(r[e])return this.colorSrc[e]=a,r[e]}}}return a===this.layers.length&&(this.colorSrc[e]=null),null}},{key:"redraw",value:function(e){if("number"===typeof e?this.calcLayerColor(e):this.calcAllColor(),this.ctx){this.ctx.clearRect(0,0,480,480);for(var t=0;t<24;++t)for(var a=0;a<24;++a){var n=24*t+a,i=this.colorSrc[n];if("number"===typeof i){var r=this.imgSel[i];if("number"===typeof r){var s=this.layers[i].images[r],l=s.data[n];l?(this.ctx.fillStyle=l,this.ctx.fillRect(20*a,20*t,20,20)):this.colorSrc[n]=null}else this.colorSrc[n]=null}}}}},{key:"addImage",value:function(e,t){t?t=Object(k["a"])(t):(t=new Array(576),this.pushHistory({type:"添加图片",layerIndex:e,imgIndex:this.layers[e].images.length}));var a=this.layers[e],n=a.images.length;n||(this.imgSel[e]=0);var i=0,r="图".concat(e+1,"-").concat(n+1);while(a.images.find((function(e){return e.name===r})))r="图".concat(e+1,"-").concat(n+1,"(").concat(++i,")");return a.images.push({name:r,data:t}),n}},{key:"delImage",value:function(e,t){var a=this.layers[e],n=a.images.splice(t,1)[0],i=this.imgSel[e];return i===t?(this.imgSel[e]=null,this.redraw(e)):"number"===typeof i&&i>t&&(this.imgSel[e]=i-1),n}},{key:"changeLayerName",value:function(){var e=Object(I["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(9!=t){e.next=3;break}return this.$message({message:"背景名称不可修改",type:"warning"}),e.abrupt("return");case 3:return e.next=5,this.$prompt("请输入层级名称","提示",{confirmButtonText:"确定",cancelButtonText:"取消"});case 5:a=e.sent,this.pushHistory({type:"修改图层名称",layerIndex:t,name:this.layers[t].name}),this.$set(this.layers[t],"name",a.value),this.$message({type:"success",message:"修改成功 "});case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"onImageCopy",value:function(e,t){this.copyDlg.layerIndex=e,this.copyDlg.imgIndex=t,this.$set(this.copyDlg,"show",!0)}},{key:"copyImage",value:function(){var e=this,t=this.copyDlg.layerIndex,a=this.copyDlg.imgIndex,n={type:"复制图片",layerIndex:t,imgIndex:[]};this.copyDlg.value.forEach((function(i){var r,s=e.imageColor[i],l=[],o=Object(w["a"])(e.layers[t].images[a].data);try{for(o.s();!(r=o.n()).done;){var c=r.value;l.push(c?s(c):null)}}catch(u){o.e(u)}finally{o.f()}n.imgIndex.push(e.layers[t].images.length),e.addImage(t,l)})),this.pushHistory(n),this.$message({message:"图片已复制。",type:"success"}),this.copyDlg.show=!1}},{key:"onLayerUp",value:function(e,t){this.pushHistory({type:"移动图片",srcLayer:e,srcImg:t,dstLayer:e-1,dstImg:this.layers[e-1].images.length});var a=this.delImage(e,t);this.layers[e-1].images.push(a)}},{key:"onLayerDown",value:function(e,t){this.pushHistory({type:"移动图片",srcLayer:e,srcImg:t,dstLayer:e+1,dstImg:this.layers[e+1].images.length});var a=this.delImage(e,t);this.layers[e+1].images.push(a)}},{key:"onImageName",value:function(){var e=Object(I["a"])(regeneratorRuntime.mark((function e(t,a){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$prompt("请输入图片名称","提示",{confirmButtonText:"确定",cancelButtonText:"取消"});case 2:n=e.sent,this.pushHistory({type:"修改图片名称",layerIndex:t,imgIndex:a,name:this.layers[t].images[a].name}),this.layers[t].images[a].name=n.value,this.$message({type:"success",message:"修改成功 "});case 6:case"end":return e.stop()}}),e,this)})));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"onImageDel",value:function(e,t){var a=this.delImage(e,t);this.pushHistory({type:"删除图片",layerIndex:e,imgIndex:t,image:a}),this.$message({message:"已删除该图。",type:"warning"})}},{key:"onExport",value:function(){for(var e=this,t=[],a=0;a<this.layers.length;++a)this.layers[a].images.length&&t.push(a);for(var n=t.length?1:0,i=0,r=t;i<r.length;i++){var s=r[i];n*=this.layers[s].images.length}var l={count:n,level:t,show:!0,title:"一共".concat(t.length,"层图片，可以合成").concat(n,"张具有稀缺性的像素图"),percent:0,loading:!1,onSubmit:function(){l.loading=!0,e.exportImage(l)},onCancel:function(){var t=Object(I["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!l.loading){t.next=3;break}return t.next=3,e.$confirm("正在打包下载，确定要取消？","提示");case 3:e.exportDlg={show:!1};case 4:case"end":return t.stop()}}),t)})));function a(){return t.apply(this,arguments)}return a}()};this.exportDlg=l}},{key:"exportImage",value:function(){var e=Object(I["a"])(regeneratorRuntime.mark((function e(t){var a,n,i,r,s,l,o,c,u,h,g=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!==t.count){e.next=4;break}return this.$message({message:"没有需要合成的图片",type:"warning"}),this.exportDlg={show:!1},e.abrupt("return");case 4:if(a=new Array(t.level.length).fill(0),n=function(){for(var e=0;e<a.length;++e){if(++a[e]<g.layers[t.level[e]].images.length)return!0;a[e]=0}return!1},i=function(){return new Promise((function(e){setTimeout((function(){return e()}),1)}))},r=this.imgSel,s=this.ctx,s){e.next=11;break}return e.abrupt("return");case 11:l=function(){g.imgSel=r,g.redraw()},o=new _.a,c=0;case 14:for(this.imgSel=new Array(this.layers.length),u=0;u<t.level.length;++u)this.imgSel[t.level[u]]=a[u];return this.redraw(),h=this.canvas.toDataURL("image/png"),h=h.substring(h.lastIndexOf(",")+1),o.file("".concat(c,".png"),h,{base64:!0}),this.$set(this.exportDlg,"percent",Math.floor(++c/t.count*100)),e.next=23,i();case 23:if(this.exportDlg.show){e.next=25;break}return e.abrupt("return",l());case 25:if(n()){e.next=14;break}case 26:o.generateAsync({type:"blob"}).then((function(e){Object(C["saveAs"])(e,"nft-作品.zip")})),this.$message({message:"合成图片成功",type:"success"}),this.exportDlg={show:!1},l();case 30:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"onSave",value:function(){var e=JSON.stringify([1,this.imgSel,this.layers]),t=new _.a;t.file("data",e),t.generateAsync({type:"blob"}).then((function(e){Object(C["saveAs"])(e,"data_"+(new Date).getTime()+".nft")}))}},{key:"onLoad",value:function(){var e=Object(I["a"])(regeneratorRuntime.mark((function e(){var t,a,n,i,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.file.files){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,t=this.file.files[0],a=t.name.split(".").splice(-1).toString(),"nft"===a){e.next=7;break}throw null;case 7:return e.prev=7,e.next=10,_.a.loadAsync(t);case 10:return i=e.sent,e.next=13,null===(n=i.file("data"))||void 0===n?void 0:n.async("string");case 13:r=e.sent,s=JSON.parse(r||""),this.imgSel=s[1],this.layers=s[2],e.next=23;break;case 19:return e.prev=19,e.t0=e["catch"](7),e.next=23,this.load1(t);case 23:this.redraw(),e.next=29;break;case 26:e.prev=26,e.t1=e["catch"](2),this.$message({message:"文件类型错误,请重新选择文件",type:"warning"});case 29:case"end":return e.stop()}}),e,this,[[2,26],[7,19]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"load1",value:function(){var e=Object(I["a"])(regeneratorRuntime.mark((function e(t){var a,n,i,r,s,l,o,c,u,h,g,y,f,m,p,d,v,x,b,S;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=new FileReader,"undefined"===typeof FileReader&&this.$message({message:"您的浏览器不支持",type:"warning"}),e.next=4,new Promise((function(e,n){a.readAsText(t,"utf-8"),a.onload=function(){return e()},a.onerror=function(){return n()}}));case 4:for(r in this.imgSel=[],n=JSON.parse(a.result),i=n.imageNames,i)for(s=i[r],l=this.layers[Number(r)],l.name=s.levelName,o=s.imageName,c=n[r],u=0;u<o.length;++u){for(h=o[u],g=c[u].split(/image:|color:|alpha:/),y=g[1].split(","),f=g[2].split(","),m=g[3].split(","),p=[],d=0;d<24;d++)for(v=0;v<24;v++)x=24*d+v,1==y[x]&&0!==m[x]?(b=f[x],S=Math.floor(255*Number(m[x])),b+=S.toString(16).padStart(2,"0"),p.push(b)):p.push(null);l.images.push({name:h,data:p})}case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"pushHistory",value:function(e){0!==this.hisIndex?this.history=this.history.slice(this.hisIndex):this.history.length>=10&&this.history.pop(),this.history.unshift(e)}},{key:"popHistory",value:function(e){this.historyOp[e.type](e)}},{key:"onBack",value:function(){this.history.length&&(this.popHistory(this.history[0]),this.history=this.history.slice(1),this.redraw())}}]),a}(u["c"]);Object(c["a"])([Object(u["d"])("grid")],D.prototype,"onGrid",null),Object(c["a"])([Object(u["b"])()],D.prototype,"canvas",void 0),Object(c["a"])([Object(u["b"])()],D.prototype,"file",void 0),D=Object(c["a"])([Object(u["a"])({components:{Sketch:O["Sketch"]}})],D);var L=D,E=L,M=(a("6f48"),Object(d["a"])(E,b,S,!1,null,"b6d4618a",null)),R=M.exports,$=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},T=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"qrcode"},[a("img",{staticClass:"qrimg",attrs:{src:"http://www.gmkiss.com/wp-content/uploads/2021/11/%E5%85%83%E5%AE%87%E5%AE%99%E7%BE%A4%E4%BA%8C%E7%BB%B4%E7%A0%811232-300x300.jpeg"}}),a("br"),e._v(" 欢迎加入NFT数字创意与元宇宙交流群（请备注：NFT） ")])}],A=function(e){Object(l["a"])(a,e);var t=Object(o["a"])(a);function a(){return Object(s["a"])(this,a),t.apply(this,arguments)}return a}(u["c"]);A=Object(c["a"])([u["a"]],A);var N=A,B=N,H=(a("1926"),Object(d["a"])(B,$,T,!1,null,"78d785ac",null)),P=H.exports,U=function(e){Object(l["a"])(a,e);var t=Object(o["a"])(a);function a(){return Object(s["a"])(this,a),t.apply(this,arguments)}return a}(u["c"]);U=Object(c["a"])([Object(u["a"])({components:{Header:x,Main:R,Footer:P}})],U);var F=U,z=F,J=(a("034f"),Object(d["a"])(z,i,r,!1,null,null,null)),G=J.exports,q=a("5c96");a("0fae"),a("f43f");n["default"].use(q),n["default"].config.productionTip=!1,new n["default"]({render:function(e){return e(G)}}).$mount("#app")},f43f:function(e,t,a){}});