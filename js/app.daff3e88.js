(function(e){function t(t){for(var i,r,o=t[0],l=t[1],c=t[2],h=0,f=[];h<o.length;h++)r=o[h],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&f.push(a[r][0]),a[r]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);u&&u(t);while(f.length)f.shift()();return s.push.apply(s,c||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],i=!0,o=1;o<n.length;o++){var l=n[o];0!==a[l]&&(i=!1)}i&&(s.splice(t--,1),e=r(r.s=n[0]))}return e}var i={},a={app:0},s=[];function r(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=i,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;s.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"034f":function(e,t,n){"use strict";n("85ec")},"1d08":function(e,t,n){"use strict";n("375e")},"375e":function(e,t,n){},5877:function(e,t){e.exports=JSZip},"5f72":function(e,t){e.exports=ELEMENT},8386:function(e,t,n){},"85ec":function(e,t,n){},"8bbf":function(e,t){e.exports=Vue},"965b":function(e,t,n){"use strict";n("d510")},"9ff4":function(e,t,n){"use strict";n("8386")},a1bc:function(e,t){e.exports={title:"GMKISS像素数字绘板",cdn:{externals:{vue:"Vue","element-ui":"ELEMENT",jszip:"JSZip"},js:["cdn/vue.runtime.min.js","cdn/element-ui/index.js","cdn/jszip.min.js"],css:["cdn/element-ui/index.css"]}}},c2f7:function(e,t,n){},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("8bbf"),a=n.n(i),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("Header"),n("Main"),n("Footer")],1)},r=[],o=n("bee2"),l=n("d4ec"),c=n("262e"),u=n("2caf"),h=n("9ab4"),f=n("1b40"),g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"main"},[n("el-page-header",{staticClass:"left",attrs:{title:"返回首页"},on:{back:e.onBack}}),n("div",{staticClass:"center"},[n("span",{staticClass:"title",attrs:{alt:"keywords"}},[e._v(e._s(e.title))])]),e._m(0)],1)},y=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"right"},[n("img",{staticClass:"logo-img",attrs:{src:"logo.png"}})])}],v=n("a1bc"),m=function(e){Object(c["a"])(n,e);var t=Object(u["a"])(n);function n(){return Object(l["a"])(this,n),t.apply(this,arguments)}return Object(o["a"])(n,[{key:"title",get:function(){return v["title"]}},{key:"onBack",value:function(){location.href=location.origin}}]),n}(f["c"]);m=Object(h["a"])([f["a"]],m);var d=m,p=d,x=(n("e50b"),n("2877")),b=Object(x["a"])(p,g,y,!1,null,"6b7699d2",null),S=b.exports,w=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"main"},[n("div",[n("div",{staticClass:"size"},[e._v(" 规格： "),n("span",{class:480===e.canvasSize?"size-focus":"",on:{click:function(t){return e.onSize(480)}}},[e._v("24 x 24格")]),n("label",{staticStyle:{color:"#ccc"}},[e._v("  |  ")]),n("span",{class:960===e.canvasSize?"size-focus":"",on:{click:function(t){return e.onSize(960)}}},[e._v("48 x 48格")])]),n("div",{staticClass:"body",style:"max-width:"+e.canvasSize+"px;max-height:"+e.canvasSize+"px"},[n("canvas",{ref:"grid",staticClass:"grid",attrs:{width:e.canvasSize,height:e.canvasSize}}),n("canvas",{ref:"canvas",staticClass:"canvas",attrs:{width:e.canvasSize,height:e.canvasSize}})]),n("div",{staticClass:"btns"},[n("el-radio",{attrs:{value:e.grid,label:!0},nativeOn:{click:function(t){return t.preventDefault(),e.onGridChange()}}},[e._v(" 显示网格 ")]),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.onExport}},[e._v(" 合成图片 ")]),n("el-button",{attrs:{size:"small"},on:{click:e.onSave}},[e._v("本地暂存")]),n("el-button",{attrs:{size:"small"},on:{click:function(t){return e.file.click()}}},[n("input",{ref:"file",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:e.onLoad}}),e._v(" 本地读取 ")]),n("el-button",{attrs:{size:"small"},on:{click:function(t){return e.onUrl("http://www.gmkiss.com/nftdraw/")}}},[e._v(" 绘画教程 ")])],1)]),n("div",{staticClass:"tool"},[n("div",{staticClass:"tool-left"},[n("el-container",{staticClass:"history"},[n("el-header",[e._v("动作记录")]),n("el-main",[n("ul",{staticClass:"history-list"},e._l(e.history,(function(t,i){return n("li",{key:i,style:i<e.hisIndex?"color: #aaa":"",on:{click:function(t){return e.onBack(i)}}},[e._v(" "+e._s(t.type)+" ")])})),0)]),n("el-footer",[n("el-button",{attrs:{type:"text"},on:{click:function(t){return e.onBack(e.hisIndex+1)}}},[e._v(" 撤回上一步 ")])],1)],1),n("el-radio-group",{model:{value:e.tool,callback:function(t){e.tool=t},expression:"tool"}},[n("el-radio",{attrs:{label:1}},[e._v("画笔")]),n("el-radio",{attrs:{label:0}},[e._v("橡皮")]),n("el-radio",{attrs:{label:2}},[e._v("吸管")])],1),n("Sketch",{staticStyle:{"margin-top":"10px"},model:{value:e.colors,callback:function(t){e.colors=t},expression:"colors"}})],1),n("div",{staticClass:"tool-right"},[n("el-collapse",{staticClass:"layer",attrs:{accordion:""},model:{value:e.layerSel,callback:function(t){e.layerSel=t},expression:"layerSel"}},e._l(e.layers,(function(t,i){return n("el-collapse-item",{key:i,attrs:{name:i}},[n("div",{staticClass:"layer-title",attrs:{slot:"title",title:t.name},slot:"title"},[n("i",{class:t.show?"icon-eye-show":"icon-eye-hide",on:{click:function(t){return t.stopPropagation(),e.onLayerShow(i)}}}),e._v(" "+e._s(t.name)+" ")]),e._l(t.images,(function(t,a){return n("div",{key:a,staticClass:"layer-item"},[n("el-radio",{staticClass:"img-title",attrs:{value:e.imgSel[i],label:a,title:t.name},nativeOn:{click:function(t){return t.preventDefault(),e.onImageChange(i,a)}}},[e._v(" "+e._s(t.name)+" ")]),n("i",{staticClass:"el-icon-copy-document",staticStyle:{cursor:"pointer"},attrs:{title:"复制图层"},on:{click:function(t){return e.onImageCopy(i,a)}}}),0!==i?n("i",{staticClass:"el-icon-top",staticStyle:{cursor:"pointer"},attrs:{title:"上移一层"},on:{click:function(t){return e.onLayerUp(i,a)}}}):e._e(),i!==e.layers.length-1?n("i",{staticClass:"el-icon-bottom",staticStyle:{cursor:"pointer"},attrs:{title:"下移一层"},on:{click:function(t){return e.onLayerDown(i,a)}}}):e._e(),n("i",{staticClass:"el-icon-edit",staticStyle:{cursor:"pointer"},attrs:{title:"修改名称"},on:{click:function(t){return e.onImageName(i,a)}}}),n("i",{staticClass:"el-icon-delete",staticStyle:{cursor:"pointer"},attrs:{title:"删除"},on:{click:function(t){return e.onImageDel(i,a)}}})],1)})),n("div",{staticClass:"layer-btn"},[n("i",{staticClass:"el-icon-circle-plus-outline",on:{click:function(t){return e.addImage(i)}}},[e._v(" 添加新图 ")]),n("i",{staticClass:"el-icon-edit",on:{click:function(t){return e.changeLayerName(i)}}},[e._v(" 修改层名 ")])])],2)})),1)],1)]),e.exportDlg.show?n("el-dialog",{attrs:{"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,title:e.exportDlg.title,visible:e.exportDlg.show},on:{"update:visible":function(t){return e.$set(e.exportDlg,"show",t)}}},[n("span",{staticStyle:{"font-size":"1.1rem"}},[e._v(e._s(e.exportDlg.desc))]),n("el-progress",{attrs:{"text-inside":!0,"stroke-width":26,percentage:e.exportDlg.percent}}),n("span",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.exportDlg.onCancel}},[e._v(" 取 消 ")]),n("el-button",{attrs:{type:"primary",loading:e.exportDlg.loading,disabled:e.exportDlg.loading},on:{click:e.exportDlg.onSubmit}},[e._v(" 打包下载 ")])],1)],1):e._e(),n("el-dialog",{attrs:{title:"请选择复制图片的种类",visible:e.copyDlg.show,width:"30%"},on:{"update:visible":function(t){return e.$set(e.copyDlg,"show",t)}}},[n("el-checkbox-group",{model:{value:e.copyDlg.value,callback:function(t){e.$set(e.copyDlg,"value",t)},expression:"copyDlg.value"}},e._l(e.copyDlg.types,(function(t){return n("el-checkbox",{key:t,attrs:{label:t}},[e._v(" "+e._s(t)+" ")])})),1),n("div",{staticStyle:{"margin-top":"14px"}},[e._v(" 注意：复制出的图片为同名图片，参与排列组合的方式为轮替排列。如果想按普通方式组合，可以手动修改为不同名称。 ")]),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.copyDlg.show=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e.copyImage}},[e._v("确 定")])],1)],1)],1)},k=[],I=n("b85c"),C=n("2909"),O=n("1da1"),_=(n("96cf"),n("99af"),n("fb6a"),n("ac1f"),n("a9e3"),n("d3b7"),n("159b"),n("4d90"),n("25f0"),n("7db0"),n("b0c0"),n("a434"),n("cb29"),n("8a79"),n("e9c4"),n("1276"),n("c345")),j=n("5877"),D=n.n(j),L=n("21a6"),E=function(e){Object(c["a"])(n,e);var t=Object(u["a"])(n);function n(){var e;return Object(l["a"])(this,n),e=t.apply(this,arguments),e.canvasSize=480,e.grid=!0,e.tool=1,e.colors={rgba:{r:25,g:77,b:51,a:1}},e.layers=[],e.layerSel=null,e.imgSel=[],e.colorSrc=[],e.copyDlg={layerIndex:0,imgIndex:0,show:!1,types:["原图","变色1","变色2","变色3"],value:["原图"]},e.imageColor={"原图":function(e){return e},"变色1":function(e){return"#".concat(e.slice(1,3)).concat(e.slice(5,7)).concat(e.slice(3,5)).concat(e.slice(7,9))},"变色2":function(e){return"#".concat(e.slice(3,5)).concat(e.slice(1,3)).concat(e.slice(5,7)).concat(e.slice(7,9))},"变色3":function(e){return"#".concat(e.slice(5,7)).concat(e.slice(1,3)).concat(e.slice(3,5)).concat(e.slice(7,9))}},e.exportDlg={show:!1},e.history=[],e.hisIndex=0,e.historyOp={},e}return Object(o["a"])(n,[{key:"onSize",value:function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.canvasSize!==t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.$confirm("切换画布将丢失当前绘画，确定要切换画布吗？","提示");case 4:this.canvasSize=t,this.initLayer(),this.initHistory(),this.$nextTick((function(){return n.onGrid()}));case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"canvasCount",get:function(){return this.canvasSize/20}},{key:"mounted",value:function(){var e=this;this.initLayer(),this.initHistory(),this.initCanvas(),window.onbeforeunload=function(){return"确定要退出页面吗？"},this.$nextTick((function(){return e.onGrid()}))}},{key:"onGridChange",value:function(){this.grid=!this.grid}},{key:"onGrid",value:function(){var e=this.$refs.grid,t=null===e||void 0===e?void 0:e.getContext("2d");if(t){var n=e.getBoundingClientRect().width,i=this.canvas.getBoundingClientRect().width,a=i/n,s=e.width/2,r=this.canvasCount/2,o=Math.round(20*r*a-.5);t.clearRect(0,0,this.canvasSize+20,this.canvasSize+20),t.lineWidth=.5,t.strokeStyle="#ccc",t.beginPath();for(var l=0;l<=r;++l){var c=Math.round(20*l*a+.5)-.5,u=Math.round(20*l*a-.5)+.5;t.moveTo(s+c,0),t.lineTo(s+c,this.canvasSize+20),t.moveTo(s-u,0),t.lineTo(s-u,this.canvasSize+20),t.moveTo(0,s+c),t.lineTo(this.canvasSize+20,s+c),t.moveTo(0,s-u),t.lineTo(this.canvasSize+20,s-u)}t.stroke(),t.lineWidth=1,t.strokeStyle="#aaa",t.beginPath(),t.moveTo(s-o,s-o),t.lineTo(s+o,s-o),t.lineTo(s+o,s+o),t.lineTo(s-o,s+o),t.lineTo(s-o,s-o),t.stroke(),this.grid||(t.fillStyle="white",t.fillRect(s-o,s-o,2*o,2*o))}}},{key:"initCanvas",value:function(){this.canvas.addEventListener("mousedown",this.onMouseDown),this.canvas.addEventListener("touchstart",this.onMouseDown)}},{key:"ctx",get:function(){return this.canvas.getContext("2d")}},{key:"setDrawing",value:function(e){if(e){if(this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("touchmove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("touchend",this.onMouseUp),this.ctx){var t=this.colors.rgba;this.ctx.fillStyle="rgba(".concat(t.r,",").concat(t.g,",").concat(t.b,",").concat(t.a,")")}}else this.canvas.removeEventListener("mousemove",this.onMouseMove),this.canvas.removeEventListener("touchmove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("touchend",this.onMouseUp)}},{key:"draw",value:function(e,t){if(this.ctx&&"number"===typeof this.layerSel){var n=20*e,i=20*t,a=t*this.canvasCount+e,s=this.colorSrc[a];if(0===this.tool){if("number"!==typeof s||s>this.layerSel)return;var r=this.imgSel[this.layerSel];if("number"!==typeof r)return;var o=this.layers[this.layerSel].images[r].data;if(o[a]=null,s!==this.layerSel)return;var l=this.delColor(a);if(l){var c=this.ctx.fillStyle;this.ctx.fillStyle=l,this.ctx.fillRect(n,i,20,20),this.ctx.fillStyle=c}else this.ctx.clearRect(n,i,20,20)}else{if("string"===typeof this.ctx.fillStyle){var u=/\(.*,.*,.*,(.*)\)/.exec(this.ctx.fillStyle);if(u&&Number(u[1])<=0)return;if(u=/#.{2}.{2}.{2}(.{2})/.exec(this.ctx.fillStyle),u&&"00"===u[1])return}if("number"!==typeof s||this.layerSel<=s){this.layerSel!==s&&(this.colorSrc[a]=this.layerSel,this.ctx.clearRect(n,i,20,20)),this.ctx.fillRect(n,i,20,20);var h=this.imgSel[this.layerSel];if("number"===typeof h){var f=this.ctx.getImageData(n,i,1,1).data,g="#";f.forEach((function(e){return g+=e.toString(16).padStart(2,"0")})),this.layers[this.layerSel].images[h].data[a]=g}}else{var y=this.ctx.getImageData(n,i,1,1);this.ctx.clearRect(n,i,1,1);var v=this.imgSel[this.layerSel];if("number"===typeof v){var m=this.layers[this.layerSel].images[v].data[a];if(m){var d=this.ctx.fillStyle;this.ctx.fillStyle=m,this.ctx.fillRect(n,i,1,1),this.ctx.fillStyle=d}this.ctx.fillRect(n,i,1,1);var p=this.ctx.getImageData(n,i,1,1).data;m="#",p.forEach((function(e){return m+=e.toString(16).padStart(2,"0")})),this.layers[this.layerSel].images[v].data[a]=m}this.ctx.putImageData(y,n,i)}}}}},{key:"onMouseDown",value:function(e){if(e.preventDefault(),"number"===typeof this.layerSel&&"number"===typeof this.imgSel[this.layerSel]){var t=this.layerSel,n=this.imgSel[this.layerSel]||0;1===this.tool?this.pushHistory({type:"画笔",layerIndex:t,imgIndex:n,data:Object(C["a"])(this.layers[t].images[n].data)}):0===this.tool&&this.pushHistory({type:"橡皮",layerIndex:t,imgIndex:n,data:Object(C["a"])(this.layers[t].images[n].data)}),this.setDrawing(!0),this.onMouseMove(e)}else this.$message({message:"需要创建并选择一张图才能进行绘画——1.点击右侧图层。2.添加新图。3.选择图片进行绘画。",type:"warning"})}},{key:"onMouseMove",value:function(e){var t;t=e.changedTouches?e.changedTouches[0]:e;var n=this.canvas.getBoundingClientRect(),i=n.width/this.canvasCount,a=Math.round(t.clientX-n.left),s=Math.round(t.clientY-n.top);if(!(a<=0||s<=0||a>=n.width||s>=n.height)){var r=Math.floor(a/i),o=Math.floor(s/i);if(2===this.tool){var l,c,u=null===(l=this.ctx)||void 0===l||null===(c=l.getImageData(20*r,20*o,1,1))||void 0===c?void 0:c.data;u&&(this.colors={rgba:{r:u[0],g:u[1],b:u[2],a:u[3]/255}})}else this.draw(r,o)}}},{key:"onMouseUp",value:function(){this.setDrawing(!1)}},{key:"onUrl",value:function(e){window.open(e,"_blank")}},{key:"initLayer",value:function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(this.layers=[],this.imgSel=[],this.colorSrc=new Array(this.canvasCount*this.canvasCount),t=0;t<9;++t)this.layers.push({show:!0,name:"图层 ".concat(t+1),images:[]}),this.imgSel.push(null);this.layers.push({show:!0,name:"背景",images:[]}),this.imgSel.push(null);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"onLayerShow",value:function(e){var t=this.layers[e];t.show=!t.show,this.redraw(e)}},{key:"onImageChange",value:function(e,t){this.$set(this.imgSel,e,this.imgSel[e]===t?null:t),this.redraw(e)}},{key:"calcAllColor",value:function(){for(var e=0;e<this.colorSrc.length;++e){for(var t=0;t<this.layers.length;++t){var n=this.layers[t];if(n.show){var i=this.imgSel[t];if("number"===typeof i){var a=n.images[i].data[e];if(a)break}}}t===this.layers.length?this.colorSrc[e]=null:this.colorSrc[e]=t}}},{key:"calcLayerColor",value:function(e){var t=this.layers[e],n=this.imgSel[e];if(t.show&&"number"===typeof n){if("number"===typeof n)for(var i=0;i<this.colorSrc.length;++i){var a=this.colorSrc[i];if(!("number"===typeof a&&a<e)){var s=t.images[n].data[i];s?this.colorSrc[i]=e:a===e&&this.delColor(i)}}}else for(var r=0;r<this.colorSrc.length;++r)this.colorSrc[r]===e&&this.delColor(r)}},{key:"delColor",value:function(e){var t=this.colorSrc[e];if("number"!==typeof t)return null;for(var n=t+1;n<this.layers.length;++n){var i=this.layers[n];if(i.show){var a=this.imgSel[n];if("number"===typeof a){var s=i.images[a].data;if(s[e])return this.colorSrc[e]=n,s[e]}}}return n===this.layers.length&&(this.colorSrc[e]=null),null}},{key:"redraw",value:function(e){if("number"===typeof e?this.calcLayerColor(e):this.calcAllColor(),this.ctx){this.ctx.clearRect(0,0,this.canvasSize,this.canvasSize);for(var t=0;t<this.canvasCount;++t)for(var n=0;n<this.canvasCount;++n){var i=t*this.canvasCount+n,a=this.colorSrc[i];if("number"===typeof a){var s=this.imgSel[a];if("number"===typeof s){var r=this.layers[a].images[s],o=r.data[i];o?(this.ctx.fillStyle=o,this.ctx.fillRect(20*n,20*t,20,20)):this.colorSrc[i]=null}else this.colorSrc[i]=null}}}}},{key:"addImage",value:function(e,t){t?t=Object(C["a"])(t):(t=new Array(this.canvasCount*this.canvasCount),this.pushHistory({type:"添加图片",layerIndex:e,imgIndex:this.layers[e].images.length}));var n=this.layers[e],i=n.images.length;i||(this.imgSel[e]=0);var a=0,s="图".concat(e+1,"-").concat(i+1);while(n.images.find((function(e){return e.name===s})))s="图".concat(e+1,"-").concat(i+1,"(").concat(++a,")");return n.images.push({name:s,data:t}),i}},{key:"delImage",value:function(e,t){var n=this.layers[e],i=n.images.splice(t,1)[0],a=this.imgSel[e];return a===t?(this.imgSel[e]=null,this.redraw(e)):"number"===typeof a&&a>t&&(this.imgSel[e]=a-1),i}},{key:"changeLayerName",value:function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(9!=t){e.next=3;break}return this.$message({message:"背景名称不可修改",type:"warning"}),e.abrupt("return");case 3:return e.next=5,this.$prompt("请输入层级名称","提示",{confirmButtonText:"确定",cancelButtonText:"取消"});case 5:n=e.sent,this.pushHistory({type:"修改图层名称",layerIndex:t,name:this.layers[t].name}),this.$set(this.layers[t],"name",n.value),this.$message({type:"success",message:"修改成功 "});case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"onImageCopy",value:function(e,t){this.copyDlg.layerIndex=e,this.copyDlg.imgIndex=t,this.$set(this.copyDlg,"show",!0)}},{key:"copyImage",value:function(){var e=this,t=this.copyDlg.layerIndex,n=this.copyDlg.imgIndex,i={type:"复制图片",layerIndex:t,imgIndex:[]};this.copyDlg.value.forEach((function(a){var s,r=e.imageColor[a],o=[],l=Object(I["a"])(e.layers[t].images[n].data);try{for(l.s();!(s=l.n()).done;){var c=s.value;o.push(c?r(c):null)}}catch(u){l.e(u)}finally{l.f()}i.imgIndex.push(e.layers[t].images.length),e.addImage(t,o)})),this.pushHistory(i),this.$message({message:"图片已复制。",type:"success"}),this.copyDlg.show=!1}},{key:"onLayerUp",value:function(e,t){this.pushHistory({type:"移动图片",srcLayer:e,srcImg:t,dstLayer:e-1,dstImg:this.layers[e-1].images.length});var n=this.delImage(e,t);this.layers[e-1].images.push(n)}},{key:"onLayerDown",value:function(e,t){this.pushHistory({type:"移动图片",srcLayer:e,srcImg:t,dstLayer:e+1,dstImg:this.layers[e+1].images.length});var n=this.delImage(e,t);this.layers[e+1].images.push(n)}},{key:"onImageName",value:function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(t,n){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$prompt("请输入图片名称","提示",{confirmButtonText:"确定",cancelButtonText:"取消"});case 2:i=e.sent,this.pushHistory({type:"修改图片名称",layerIndex:t,imgIndex:n,name:this.layers[t].images[n].name}),this.layers[t].images[n].name=i.value,this.$message({type:"success",message:"修改成功 "});case 6:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"onImageDel",value:function(e,t){var n=this.delImage(e,t);this.pushHistory({type:"删除图片",layerIndex:e,imgIndex:t,image:n}),this.$message({message:"已删除该图。",type:"warning"})}},{key:"onExport",value:function(){for(var e=this,t=[],n=0;n<this.layers.length;++n)this.layers[n].images.length&&t.push(n);for(var i=t.length?1:0,a=0,s=t;a<s.length;a++){var r=s[a];i*=this.layers[r].images.length}var o={count:i,level:t,show:!0,title:"一共".concat(t.length,"层图片，可以合成").concat(i,"张具有稀缺性的像素图"),percent:0,loading:!1,desc:"",onSubmit:function(){o.loading=!0,e.exportImage(o)},onCancel:function(){var t=Object(O["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!o.loading){t.next=3;break}return t.next=3,e.$confirm("正在打包下载，确定要取消？","提示");case 3:e.exportDlg={show:!1};case 4:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}()};this.exportDlg=o}},{key:"exportImage",value:function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(t){var n,i,a,s,r,o,l,c,u,h,f,g,y,v,m=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!==t.count){e.next=4;break}return this.$message({message:"没有需要合成的图片",type:"warning"}),this.exportDlg={show:!1},e.abrupt("return");case 4:if(n=new Array(t.level.length).fill(0),i=function(){for(var e=0;e<n.length;++e){if(++n[e]<m.layers[t.level[e]].images.length)return!0;n[e]=0}return!1},a=function(){return new Promise((function(e){setTimeout((function(){return e()}),1)}))},s=this.imgSel,r=this.ctx,r){e.next=11;break}return e.abrupt("return");case 11:o=function(){m.imgSel=s,m.redraw()},c=0,h="",f=5e3,g=function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(n){var i,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.desc="已合成 ".concat(c," / ").concat(t.count).concat(h," (每").concat(f,"张图片打包下载一次)"),c%f!==0&&!n){e.next=11;break}return i="nft-".concat(c,".zip"),h="，正在打包 "+i,a=l,l=new D.a,e.next=8,null===a||void 0===a?void 0:a.generateAsync({type:"blob",compression:"STORE"});case 8:s=e.sent,h.endsWith(i)&&(h=""),Object(L["saveAs"])(s,i);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g();case 17:for(this.imgSel=new Array(this.layers.length),y=0;y<t.level.length;++y)this.imgSel[t.level[y]]=n[y];return this.redraw(),v=this.canvas.toDataURL("image/png"),v=v.substring(v.lastIndexOf(",")+1),l.file("".concat(c+1,".png"),v,{base64:!0}),this.$set(this.exportDlg,"percent",Math.floor(++c/t.count*100)),u=g(),e.next=27,a();case 27:if(this.exportDlg.show){e.next=29;break}return e.abrupt("return",o());case 29:if(i()){e.next=17;break}case 30:return e.next=32,u;case 32:if(c%f===0){e.next=35;break}return e.next=35,g(!0);case 35:this.$message({message:"合成图片成功",type:"success"}),this.exportDlg={show:!1},o();case 38:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"onSave",value:function(){var e=JSON.stringify([2,this.canvasSize,this.imgSel,this.layers]),t=new D.a;t.file("data",e),t.generateAsync({type:"blob"}).then((function(e){Object(L["saveAs"])(e,"data_"+(new Date).getTime()+".nft")}))}},{key:"onLoad",value:function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(){var t,n,i,a,s,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.file.files){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,t=this.file.files[0],this.file.value="",n=t.name.split(".").splice(-1).toString(),"nft"===n){e.next=8;break}throw null;case 8:return this.initHistory(),e.prev=9,e.next=12,D.a.loadAsync(t);case 12:return a=e.sent,e.next=15,null===(i=a.file("data"))||void 0===i?void 0:i.async("string");case 15:s=e.sent,console.log(s),r=JSON.parse(s||""),1===r[0]?(this.canvasSize=480,this.imgSel=r[1],this.layers=r[2]):(this.canvasSize=r[1],this.imgSel=r[2],this.layers=r[3]),this.colorSrc=new Array(this.canvasCount*this.canvasCount),e.next=26;break;case 22:return e.prev=22,e.t0=e["catch"](9),e.next=26,this.loadOld(t);case 26:return e.next=28,this.$nextTick();case 28:this.onGrid(),this.redraw(),e.next=35;break;case 32:e.prev=32,e.t1=e["catch"](2),this.$message({message:"文件类型错误,请重新选择文件",type:"warning"});case 35:case"end":return e.stop()}}),e,this,[[2,32],[9,22]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadOld",value:function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(t){var n,i,a,s,r,o,l,c,u,h,f,g,y,v,m,d,p,x,b,S;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.canvasSize=480,n=new FileReader,"undefined"===typeof FileReader&&this.$message({message:"您的浏览器不支持",type:"warning"}),e.next=5,new Promise((function(e,i){n.readAsText(t,"utf-8"),n.onload=function(){return e()},n.onerror=function(){return i()}}));case 5:for(s in this.imgSel=[],this.initLayer(),i=JSON.parse(n.result),a=i.imageNames,a)for(r=a[s],o=this.layers[Number(s)],o.name=r.levelName,l=r.imageName,c=i[s],u=0;u<l.length;++u){for(h=l[u],f=c[u].split(/image:|color:|alpha:/),g=f[1].split(","),y=f[2].split(","),v=f[3].split(","),m=[],d=0;d<this.canvasCount;d++)for(p=0;p<this.canvasCount;p++)x=d*this.canvasCount+p,1==g[x]&&0!==v[x]?(b=y[x],S=Math.floor(255*Number(v[x])),b+=S.toString(16).padStart(2,"0"),m.push(b)):m.push(null);o.images.push({name:h,data:m})}case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"initHistory",value:function(){var e=this;this.history=[],this.historyOp={"修改图层名称":function(t){var n=e.layers[t.layerIndex].name;e.layers[t.layerIndex].name=t.name,t.name=n},"添加图片":function(t){if(t.image)e.layers[t.layerIndex].images.splice(t.imgIndex,0,t.image),t.image=void 0;else{e.imgSel[t.layerIndex]===t.imgIndex&&(e.imgSel[t.layerIndex]=null);var n=e.layers[t.layerIndex].images.splice(t.imgIndex,1)[0];t.image=n}},"修改图片名称":function(t){var n=e.layers[t.layerIndex].images[t.imgIndex].name;e.layers[t.layerIndex].images[t.imgIndex].name=t.name,t.name=n},"复制图片":function(t){if(t.image){var n=t.image;t.imgIndex.forEach((function(i,a){e.layers[t.layerIndex].images.splice(i,0,n[a])})),t.image=void 0}else t.image=[],t.imgIndex.forEach((function(n){var i;e.imgSel[t.layerIndex]===n&&(e.imgSel[t.layerIndex]=null);var a=e.layers[t.layerIndex].images.splice(n,1)[0];null===(i=t.image)||void 0===i||i.push(a)}))},"移动图片":function(t){e.imgSel[t.dstLayer]===t.dstImg&&(e.imgSel[t.dstLayer]=null);var n=e.layers[t.dstLayer].images.splice(t.dstImg,1)[0];e.layers[t.srcLayer].images.splice(t.srcImg,0,n);var i=[t.dstLayer,t.srcLayer];t.srcLayer=i[0],t.dstLayer=i[1];var a=[t.dstImg,t.srcImg];t.srcImg=a[0],t.dstImg=a[1]},"删除图片":function(t){if(t.image)e.layers[t.layerIndex].images.splice(t.imgIndex,0,t.image),t.image=void 0;else{e.imgSel[t.layerIndex]===t.imgIndex&&(e.imgSel[t.layerIndex]=null);var n=e.layers[t.layerIndex].images.splice(t.imgIndex,1)[0];t.image=n}},"画笔":function(t){var n=e.layers[t.layerIndex].images[t.imgIndex].data;e.layers[t.layerIndex].images[t.imgIndex].data=t.data,t.data=n},"橡皮":function(t){var n=e.layers[t.layerIndex].images[t.imgIndex].data;e.layers[t.layerIndex].images[t.imgIndex].data=t.data,t.data=n}}}},{key:"pushHistory",value:function(e){0!==this.hisIndex?this.history=this.history.slice(this.hisIndex):this.history.length>=10&&this.history.pop(),this.hisIndex=0,this.history.unshift(e)}},{key:"popHistory",value:function(e){this.historyOp[e.type](e)}},{key:"onBack",value:function(e){if(!(e>=this.history.length)&&e!==this.hisIndex){if(e<this.hisIndex)for(var t=this.hisIndex-1;t>=e;--t)this.popHistory(this.history[t]);else for(var n=this.hisIndex;n<e;++n)this.popHistory(this.history[n]);this.hisIndex=e,this.redraw()}}}]),n}(a.a);Object(h["a"])([Object(f["d"])("grid")],E.prototype,"onGrid",null),Object(h["a"])([Object(f["b"])()],E.prototype,"canvas",void 0),Object(h["a"])([Object(f["b"])()],E.prototype,"file",void 0),E=Object(h["a"])([Object(f["a"])({components:{Sketch:_["Sketch"]}})],E);var z=E,M=z,R=(n("9ff4"),n("1d08"),Object(x["a"])(M,w,k,!1,null,"05d60642",null)),$=R.exports,T=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},H=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"main"},[n("div",{staticClass:"qrcode"},[n("img",{staticClass:"img",attrs:{src:"http://www.gmkiss.com/wp-content/uploads/2021/11/%E5%85%83%E5%AE%87%E5%AE%99%E7%BE%A4%E4%BA%8C%E7%BB%B4%E7%A0%811232-300x300.jpeg"}}),n("div",{staticClass:"desc"},[n("div",[e._v("欢迎加入")]),n("div",[e._v("数字艺术与元宇宙交流群")]),n("div",[e._v("(请备注: 数字艺术或元宇宙)")])])]),n("div",{staticClass:"copyright"},[e._v(" @2016-2021  云浮市佰熹互联网新技术有限公司   粤ICP备15102324号-1   粤公网安备44530202000023 ")])])}],A=function(e){Object(c["a"])(n,e);var t=Object(u["a"])(n);function n(){return Object(l["a"])(this,n),t.apply(this,arguments)}return Object(o["a"])(n)}(f["c"]);A=Object(h["a"])([f["a"]],A);var B=A,N=B,P=(n("965b"),Object(x["a"])(N,T,H,!1,null,"3ba062de",null)),U=P.exports,G=function(e){Object(c["a"])(n,e);var t=Object(u["a"])(n);function n(){return Object(l["a"])(this,n),t.apply(this,arguments)}return Object(o["a"])(n)}(f["c"]);G=Object(h["a"])([Object(f["a"])({components:{Header:S,Main:$,Footer:U}})],G);var J=G,F=J,W=(n("034f"),Object(x["a"])(F,s,r,!1,null,null,null)),V=W.exports,Z=n("5f72");n("0fae"),n("f43f");a.a.use(Z),a.a.config.productionTip=!1,new a.a({render:function(e){return e(V)}}).$mount("#app")},d510:function(e,t,n){},e50b:function(e,t,n){"use strict";n("c2f7")},f43f:function(e,t,n){}});